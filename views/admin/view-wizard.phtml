<?php
/**
 * Wizard Template
 *
 * @package   daandev/correct-contact
 * @author    Daan van den Bergh
 *            https://daan.dev
 * @copyright © 2023-2026 Daan van den Bergh
 */

defined( 'ABSPATH' ) || exit;

use CorrectContact\Options;
use CorrectContact\Admin\Settings;

?>
<div class="wrap cc-admin">
    <h1><?php echo esc_html__( 'Correct Contact Setup Wizard', 'correct-contact' ); ?></h1>
    <h2 class="cc-nav nav-tab-wrapper">
        <a href="#" class="nav-tab nav-tab-active cc-wizard-nav-item"
           data-slide="0"><?php esc_html_e( 'Getting Started', 'correct-contact' ); ?></a>
        <a href="#" class="nav-tab cc-wizard-nav-item"
           data-slide="1"><?php esc_html_e( 'Create Account', 'correct-contact' ); ?></a>
        <a href="#" class="nav-tab cc-wizard-nav-item"
           data-slide="2"><?php esc_html_e( 'Create API Token', 'correct-contact' ); ?></a>
        <a href="#" class="nav-tab cc-wizard-nav-item"
           data-slide="3"><?php esc_html_e( 'Create App', 'correct-contact' ); ?></a>
        <a href="#" class="nav-tab cc-wizard-nav-item"
           data-slide="4"><?php esc_html_e( 'Done', 'correct-contact' ); ?></a>
    </h2>
    <div class="cc-wizard-container">
        <!-- Slide 0: Intro -->
        <div class="cc-wizard-slide" data-slide="0">
            <h2><?php esc_html_e( 'Before we get started', 'correct-contact' ); ?></h2>
            <p><?php esc_html_e( 'CorrectContact runs on your own infrastructure. It does not use third-party email verification services.', 'correct-contact' ); ?></p>
            <p><?php esc_html_e( 'Instead, we\'re going to create a small app in your own DigitalOcean account.', 'correct-contact' ); ?></p>

            <h3><?php esc_html_e( 'Why DigitalOcean?', 'correct-contact' ); ?></h3>
            <ul>
                <li><?php esc_html_e( 'Automatically create your own email validation app', 'correct-contact' ); ?></li>
                <li><?php esc_html_e( 'Unlimited email validations for a low, monthly fee', 'correct-contact' ); ?></li>
                <li><?php esc_html_e( 'Reliable, EU-based infrastructure', 'correct-contact' ); ?></li>
            </ul>

            <h3><?php esc_html_e( 'What this means for you:', 'correct-contact' ); ?></h3>
            <ul>
                <li><?php esc_html_e( 'No third-party email validation services', 'correct-contact' ); ?></li>
                <li><?php esc_html_e( 'No API limits or usage-based pricing', 'correct-contact' ); ?></li>
                <li><?php esc_html_e( 'Full control over your data and infrastructure', 'correct-contact' ); ?></li>
            </ul>

            <div class="cc-wizard-actions">
                <button type="button"
                        class="button button-primary cc-wizard-next"><?php esc_html_e( 'Get started', 'correct-contact' ); ?></button>
            </div>

            <p class="cc-wizard-footer"><?php esc_html_e( 'You\'re in control at all times. CorrectContact only automates the setup.', 'correct-contact' ); ?></p>
        </div>

        <!-- Slide 1: Create DigitalOcean account -->
        <div class="cc-wizard-slide" data-slide="1" style="display: none;">
            <h2><?php esc_html_e( 'Create your DigitalOcean account', 'correct-contact' ); ?></h2>
            <p><?php esc_html_e( 'To run the email validation service, CorrectContact uses a small app in your own DigitalOcean account.', 'correct-contact' ); ?></p>
            <p><?php esc_html_e( 'If you don\'t have a DigitalOcean account yet, create one by clicking the button below. If you\'re all set, continue to the next step.', 'correct-contact' ); ?></p>

            <div class="cc-notice info">
                <h3><?php esc_html_e( 'New to DigitalOcean?', 'correct-contact' ); ?></h3>
                <p><?php esc_html_e( 'New accounts receive $200 in free credit to try DigitalOcean for 60 days.', 'correct-contact' ); ?></p>
                <p><?php esc_html_e( 'This is more than enough to run your email validation app for weeks at no cost.', 'correct-contact' ); ?></p>
            </div>

            <div class="cc-wizard-actions">
                <a href="https://m.do.co/c/1cfcf14ddad0" target="_blank"
                   class="button button-primary"><?php esc_html_e( 'Create DigitalOcean account', 'correct-contact' ); ?></a>
                <button type="button"
                        class="button button-secondary cc-wizard-next"><?php esc_html_e( 'I already have an account → Continue', 'correct-contact' ); ?></button>
            </div>

            <p class="cc-wizard-footer"><?php esc_html_e( 'No app is created yet. You remain in full control of your account and infrastructure.', 'correct-contact' ); ?></p>
        </div>

        <!-- Slide 2: Create API token -->
        <div class="cc-wizard-slide" data-slide="2" style="display: none;">
            <h2><?php esc_html_e( 'Create a DigitalOcean API token', 'correct-contact' ); ?></h2>
            <p><?php esc_html_e( 'CorrectContact needs a DigitalOcean API token to create the email validation app for you.', 'correct-contact' ); ?></p>
            <p><?php echo wp_kses_post( __( 'This token is used <strong>only during setup</strong>. You will be prompted to remove it once the setup is complete.', 'correct-contact' ) ); ?></p>
            <div class="cc-notice info">
                <p><?php echo wp_kses_post( __( 'DigitalOcean may ask you to <strong>add a payment method</strong> when generating the API token. No charges are made at this stage. The email validation app is only created in the next step.', 'correct-contact' ) ); ?></p>
            </div>
            <p><?php esc_html_e( 'To create the API token, follow these steps', 'correct-contact' ); ?>:</p>
            <ol>
                <li><a href="https://cloud.digitalocean.com/account/api/tokens/new"
                       target="_blank"><?php esc_html_e( 'Click here to start creating a new API token', 'correct-contact' ); ?></a>
                </li>
                <li>
					<?php echo wp_kses_post( __( 'Set the <strong>Token Name</strong> to <code>Correct Contact</code>. You can leave the Expiration and Scopes setting to their defaults.', 'correct-contact' ) ); ?>
                </li>
                <li>
					<?php echo wp_kses_post( __( 'Make sure the token has the following <strong>Scopes</strong>, i.e. permissions:', 'correct-contact' ) ); ?>
                    <ul>
                        <li><?php echo wp_kses_post( __( '<strong>App:</strong> select <code>create</code> and <code>read</code>', 'correct-contact' ) ); ?></li>
                        <li><?php echo wp_kses_post( __( '<strong>Project:</strong> select <code>create</code>, <code>read</code> and <code>update</code>', 'correct-contact' ) ); ?></li>
                    </ul>
                </li>
                <li>
					<?php echo wp_kses_post( __( 'Click <strong>Generate Token</strong>. You will be prompted to <strong>Add a Payment Method</strong>, if you haven\'t yet.', 'correct-contact' ) ); ?>
                </li>
                <li>
					<?php echo wp_kses_post( __( '<strong>Copy</strong> the generated token and <strong>paste</strong> it in the field below.', 'correct-contact' ) ); ?>
                </li>
            </ol>
            <p>
                <input type="text" id="cc-do-token" class="regular-text"
                       value="<?php echo esc_attr( Options::get( Settings::DO_TOKEN ) ); ?>"
                       placeholder="<?php esc_attr_e( 'Paste your API token here', 'correct-contact' ); ?>">
            </p>

            <div class="cc-wizard-actions">
                <button type="button" class="button button-primary cc-wizard-next"
                        disabled><?php esc_html_e( 'Continue', 'correct-contact' ); ?></button>
            </div>

            <p class="cc-wizard-footer"><?php esc_html_e( 'The token is stored locally and never shared.', 'correct-contact' ); ?></p>
        </div>

        <!-- Slide 3: Create app -->
        <div class="cc-wizard-slide" data-slide="3" style="display: none;">
            <h2><?php esc_html_e( 'Create your email validation app', 'correct-contact' ); ?></h2>
            <p><?php echo wp_kses_post( __( 'Once you click <strong>Create app</strong>, CorrectContact will set up your email validation service in your DigitalOcean account.', 'correct-contact' ) ); ?></p>
            <p><?php esc_html_e( 'A lightweight email validation service called Truemail will be installed as a DigitalOcean app in your account. It validates email addresses in real time.', 'correct-contact' ); ?></p>
            <div class="cc-notice info">
                <p><?php echo wp_kses_post( __( 'The app runs on a basic server which costs <strong>$10 per month</strong>, billed directly by DigitalOcean. This setup is sufficient for most websites. You can upgrade the server later if you need more processing power or bandwidth.', 'correct-contact' ) ); ?></p>
            </div>
            <p><?php esc_html_e( 'CorrectContact does not charge for infrastructure and does not add any markup.', 'correct-contact' ); ?></p>

            <div class="cc-wizard-provision-content">
                <label for="cc-region"><strong><?php esc_html_e( 'Select datacenter region:', 'correct-contact' ); ?></strong>
                    <select id="cc-region" class="regular-text">
                        <option value=""><?php esc_html_e( 'Loading regions...', 'correct-contact' ); ?></option>
                    </select>
                </label>
                <p class="description"><?php esc_html_e( 'This determines where the app will run.', 'correct-contact' ); ?></p>
            </div>

            <div class="cc-wizard-provision-controls">
                <div class="cc-wizard-provision-progress" style="display: none;">
                    <div class="cc-wizard-progress-bar">
                        <div class="cc-wizard-progress-fill"></div>
                    </div>
                    <div class="cc-wizard-progress-status">
                        <ul class="cc-wizard-progress-steps">
                            <li data-step="project"><?php esc_html_e( 'Creating project', 'correct-contact' ); ?></li>
                            <li data-step="app"><?php esc_html_e( 'Creating app', 'correct-contact' ); ?></li>
                            <li data-step="deploy"><?php esc_html_e( 'Deploying Truemail', 'correct-contact' ); ?></li>
                            <li data-step="finalize"><?php esc_html_e( 'Finalizing configuration', 'correct-contact' ); ?></li>
                            <li data-step="done"><?php esc_html_e( 'Done!', 'correct-contact' ); ?></li>
                        </ul>
                        <p class="cc-error-message" style="display: none;"></p>
                        <div class="cc-wizard-provision-error-actions" style="display: none;">
                            <div class="cc-wizard-actions">
                                <a href="https://cloud.digitalocean.com/account/billing" target="_blank"
                                   class="button button-secondary cc-add-payment"><?php esc_html_e( 'Add payment method', 'correct-contact' ); ?></a>
                                <button type="button"
                                        class="button button-primary cc-wizard-retry"><?php esc_html_e( 'Retry setup', 'correct-contact' ); ?></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="cc-wizard-actions">
                <button type="button"
                        class="button button-primary cc-wizard-provision"
                        disabled><?php esc_html_e( 'Create app', 'correct-contact' ); ?></button>
            </div>

            <p class="cc-wizard-footer"><?php esc_html_e( 'This usually takes a few minutes.', 'correct-contact' ); ?></p>
        </div>

        <!-- Slide 4: Success -->
        <div class="cc-wizard-slide" data-slide="4" style="display: none;">
            <h2><?php esc_html_e( 'Your Truemail app is up and running!', 'correct-contact' ); ?></h2>
            <p><?php esc_html_e( 'Your email validation service is now ready to validate email addresses in your forms.', 'correct-contact' ); ?></p>
            <p><?php esc_html_e( 'CorrectContact is now connected to your Truemail app, running entirely in your own DigitalOcean account.', 'correct-contact' ); ?></p>

            <h3><?php esc_html_e( 'You\'re in control.', 'correct-contact' ); ?></h3>
            <ul>
                <li><?php esc_html_e( 'The app runs entirely in your DigitalOcean account', 'correct-contact' ); ?></li>
                <li><?php esc_html_e( 'No third-party email validation services are used', 'correct-contact' ); ?></li>
                <li><?php esc_html_e( 'CorrectContact does not process or store email addresses', 'correct-contact' ); ?></li>
            </ul>

            <p><?php esc_html_e( 'CorrectContact no longer needs your DigitalOcean API token. You can safely remove it now.', 'correct-contact' ); ?></p>

            <div class="cc-wizard-actions">
                <button type="button"
                        class="button button-primary cc-wizard-complete"><?php esc_html_e( 'Continue to settings', 'correct-contact' ); ?></button>
                <button type="button"
                        class="button button-secondary cc-wizard-remove-token"><?php esc_html_e( 'Remove API token', 'correct-contact' ); ?></button>
            </div>
        </div>
    </div>
</div>
