(()=>{let e={currentSlide:0,doToken:"",appUrl:"",accessToken:"",projectId:"",appId:"",init:function(){this.bindEvents();var e=document.getElementById("cc-do-token"),e=(e&&(this.doToken=e.value.trim(),this.doToken)&&this.validateToken(),window.location.hash);let t=0;e&&e.startsWith("#slide-")&&(e=parseInt(e.replace("#slide-","")),!isNaN(e))&&0<=e&&e<=4&&(t=e),this.showSlide(t)},bindEvents:function(){document.addEventListener("click",e=>{e.target.classList.contains("cc-wizard-nav-item")&&this.handleNavClick(e),e.target.classList.contains("cc-wizard-next")&&this.nextSlide(e),e.target.classList.contains("cc-wizard-provision")&&this.createApp(e),e.target.classList.contains("cc-wizard-remove-token")&&this.removeToken(e),e.target.classList.contains("cc-wizard-complete")&&this.completeWizard(e),e.target.classList.contains("cc-wizard-retry")&&this.retryProvisioning(e)});var e=document.getElementById("cc-do-token");e&&e.addEventListener("input",this.validateToken.bind(this)),window.addEventListener("hashchange",this.handleHashChange.bind(this))},handleNavClick:function(e){e.preventDefault();var e=e.target,t=parseInt(e.dataset.slide);e.classList.contains("disabled")||(e.classList.contains("completed")||e.classList.contains("nav-tab-active"))&&this.showSlide(t)},showSlide:function(e){document.querySelectorAll(".cc-wizard-slide").forEach(e=>{e.style.display="none",e.style.opacity="0"});let t=document.querySelector(`.cc-wizard-slide[data-slide="${e}"]`);t&&(t.style.display="block",setTimeout(()=>{t.style.transition="opacity 0.3s ease-in-out",t.style.opacity="1"},10)),this.currentSlide=e,window.location.hash="slide-"+e,this.updateNavigationStates(e),3===e&&this.fetchRegions()},fetchRegions:function(){let a=document.getElementById("cc-region"),t=document.querySelector(".cc-wizard-provision");var e;!a||1<a.options.length||((e=new FormData).append("action","cc_wizard_fetch_regions"),e.append("nonce",ccWizard.nonce),e.append("token",this.doToken),fetch(ccWizard.ajaxUrl,{method:"POST",body:e}).then(e=>e.json()).then(e=>{e.success&&e.data.regions?(a.innerHTML="",e.data.regions.forEach(e=>{var t=document.createElement("option");t.value=e.slug,t.textContent=e.name,a.appendChild(t)}),t&&(t.disabled=!1)):a.innerHTML='<option value="">'+(e.data.message||"Error loading regions")+"</option>"}).catch(()=>{a&&(a.innerHTML='<option value="">Error loading regions</option>')}))},handleHashChange:function(){var e=window.location.hash;e&&e.startsWith("#slide-")&&(e=parseInt(e.replace("#slide-","")),!isNaN(e))&&0<=e&&e<=4&&e!==this.currentSlide&&this.showSlide(e)},updateNavigationStates:function(a){document.querySelectorAll(".cc-wizard-nav-item").forEach(e=>{var t=parseInt(e.dataset.slide);e.classList.remove("nav-tab-active","completed","disabled"),t===a?e.classList.add("nav-tab-active"):t<a?e.classList.add("completed"):e.classList.add("disabled")})},nextSlide:function(e){e.preventDefault(),2===this.currentSlide&&this.saveDOToken(),this.showSlide(this.currentSlide+1)},validateToken:function(){var e=document.getElementById("cc-do-token"),e=e?e.value.trim():"",t=document.querySelector('.cc-wizard-slide[data-slide="2"] .cc-wizard-next');t&&(t.disabled=e.length<=20)},saveDOToken:function(){var e,t=document.getElementById("cc-do-token"),t=t?t.value.trim():"";(this.doToken=t).length<=20||((e=new FormData).append("action","cc_wizard_save_do_token"),e.append("nonce",ccWizard.nonce),e.append("token",t),fetch(ccWizard.ajaxUrl,{method:"POST",body:e}).then(e=>e.json()).then(e=>{e.success&&console.log("DO token saved.")}))},createApp:function(e){e.preventDefault();var e=e.target,t=document.querySelector('.cc-wizard-slide[data-slide="3"]');let a=t.querySelector(".cc-wizard-provision-content"),n=t.querySelector(".cc-wizard-provision-progress");e.style.display="none",a&&(a.style.transition="opacity 0.2s",a.style.opacity="0",setTimeout(()=>{a.style.display="none",n&&(n.style.display="flex",n.style.opacity="0",setTimeout(()=>{n.style.transition="opacity 0.3s",n.style.opacity="1"},10))},200)),this.provisionServer()},provisionServer:function(){let o=this,s=["project","app","deploy","finalize","done"],c=a=>{n=a,t=document.querySelectorAll(".cc-wizard-progress-steps li"),i=document.querySelector(".cc-wizard-progress-fill"),e=(n+1)/s.length*100,t.forEach((e,t)=>{e.classList.remove("active","complete","error"),t===n?e.classList.add("active"):t<n&&e.classList.add("complete")}),i&&(i.style.width=e+"%");var n,e,t=document.getElementById("cc-region"),i=new FormData;i.append("action","cc_wizard_provision"),i.append("nonce",ccWizard.nonce),i.append("step",s[a]),i.append("token",this.doToken),i.append("region",t?t.value:"ams3"),i.append("project_id",this.projectId),i.append("app_id",this.appId),fetch(ccWizard.ajaxUrl,{method:"POST",body:i}).then(e=>e.json()).then(e=>{var t;e.success?(e.data.app_url&&(o.appUrl=e.data.app_url),e.data.access_token&&(o.accessToken=e.data.access_token),e.data.project_id&&(o.projectId=e.data.project_id),e.data.app_id&&(o.appId=e.data.app_id),e.data.retry?setTimeout(()=>{c(a)},2e3):a<s.length-1?setTimeout(()=>{c(a+1)},500):((t=document.querySelector(".cc-wizard-progress-fill"))&&t.classList.add("success"),setTimeout(()=>{o.saveCredentials()},1e3))):o.handleProvisioningError(e.data,a)}).catch(e=>{o.handleProvisioningError({message:"Network error: "+e.message,code:"network_error"},a)})};c(0)},handleProvisioningError:function(e,t){var a=document.querySelector('.cc-wizard-slide[data-slide="3"]'),n=a.querySelector(".cc-error-message"),i=a.querySelector(".cc-wizard-provision-error-actions"),o=a.querySelector(".cc-wizard-progress-fill"),s=a.querySelector(".cc-add-payment"),a=a.querySelector(".cc-wizard-progress-steps"),c=document.querySelectorAll(".cc-wizard-progress-steps li");c[t]&&c[t].classList.add("error"),o&&(o.style.width="100%",o.classList.add("error")),a&&(a.style.display="none"),n&&(n.textContent=e.message||"An error occurred during setup.",n.style.display="block"),s&&(s.style.display="payment_method_required"===e.code?"inline-block":"none"),i&&(i.style.display="block")},retryProvisioning:function(e){e.preventDefault();var e=document.querySelector('.cc-wizard-slide[data-slide="3"]'),t=e.querySelector(".cc-wizard-progress-steps"),a=e.querySelector(".cc-error-message"),n=e.querySelector(".cc-wizard-provision-error-actions"),e=e.querySelector(".cc-wizard-progress-fill");e&&(e.style.width="0%",e.classList.remove("error","success")),t&&(t.style.display="block"),a&&(a.style.display="none"),n&&(n.style.display="none"),this.provisionServer()},saveCredentials:function(){let t=this;var e=new FormData;e.append("action","cc_wizard_save_credentials"),e.append("nonce",ccWizard.nonce),e.append("app_url",this.appUrl),e.append("access_token",this.accessToken),fetch(ccWizard.ajaxUrl,{method:"POST",body:e}).then(e=>e.json()).then(e=>{e.success?t.showSlide(4):alert("Failed to save credentials. Please try again.")}).catch(()=>{alert("Failed to save credentials. Please try again.")})},removeToken:function(e){e.preventDefault();let t=e.target,a=(t.disabled=!0,t.textContent);t.textContent="Removing...";e=new FormData;e.append("action","cc_wizard_remove_token"),e.append("nonce",ccWizard.nonce),fetch(ccWizard.ajaxUrl,{method:"POST",body:e}).then(e=>e.json()).then(e=>{e.success?(t.textContent="Token removed",t.classList.add("button-disabled")):(t.disabled=!1,t.textContent=a,alert("Failed to remove token. Please try again."))}).catch(()=>{t.disabled=!1,t.textContent=a,alert("Failed to remove token. Please try again.")})},completeWizard:function(e){e.preventDefault();let t=e.target,a=(t.disabled=!0,t.textContent);t.textContent="Completing...";e=new FormData;e.append("action","cc_wizard_complete"),e.append("nonce",ccWizard.nonce),fetch(ccWizard.ajaxUrl,{method:"POST",body:e}).then(e=>e.json()).then(e=>{e.success?window.location.reload():(t.disabled=!1,t.textContent=a,alert("Failed to complete setup. Please try again."))}).catch(()=>{t.disabled=!1,t.textContent=a,alert("Failed to complete setup. Please try again.")})}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{document.querySelector(".cc-admin")&&e.init()}):document.querySelector(".cc-admin")&&e.init()})();