(s=>{let e={currentSlide:0,doToken:"",appUrl:"",accessToken:"",init:function(){this.bindEvents(),this.showSlide(0)},bindEvents:function(){s(document).on("click",".cc-wizard-nav-item",this.handleNavClick.bind(this)),s(document).on("click",".cc-wizard-next",this.nextSlide.bind(this)),s(document).on("input","#cc-do-token",this.validateToken.bind(this)),s(document).on("click",".cc-wizard-create-app",this.createApp.bind(this)),s(document).on("click",".cc-wizard-remove-token",this.removeToken.bind(this)),s(document).on("click",".cc-wizard-complete",this.completeWizard.bind(this))},handleNavClick:function(e){e.preventDefault();var e=s(e.currentTarget),t=parseInt(e.data("slide"));e.hasClass("disabled")||(e.hasClass("completed")||e.hasClass("nav-tab-active"))&&this.showSlide(t)},showSlide:function(e){s(".cc-wizard-slide").hide(),s('.cc-wizard-slide[data-slide="'+e+'"]').fadeIn(300),this.currentSlide=e,this.updateNavigationStates(e)},updateNavigationStates:function(a){s(".cc-wizard-nav-item").each(function(){var e=s(this),t=parseInt(e.data("slide"));e.removeClass("nav-tab-active completed disabled"),t===a?e.addClass("nav-tab-active"):t<a?e.addClass("completed"):e.addClass("disabled")})},nextSlide:function(e){e.preventDefault(),2===this.currentSlide&&(this.doToken=s("#cc-do-token").val().trim()),this.showSlide(this.currentSlide+1)},validateToken:function(){var e=s("#cc-do-token").val().trim(),t=s('.cc-wizard-slide[data-slide="2"] .cc-wizard-next');20<e.length?t.prop("disabled",!1):t.prop("disabled",!0)},createApp:function(e){e.preventDefault();var e=s(e.currentTarget),t=s('.cc-wizard-slide[data-slide="3"]'),a=t.find(".cc-wizard-content-main");let i=t.find(".cc-wizard-progress");t.find(".cc-wizard-error");e.hide(),a.fadeOut(200,function(){i.fadeIn(300)}),this.provisionServer()},provisionServer:function(){let c=this;let o=["project","server","install","secure","done"];!function t(i){var e,a,r,n;e=i,a=s(".cc-wizard-progress-steps li"),r=s(".cc-wizard-progress-fill"),n=(e+1)/o.length*100,a.removeClass("active complete error"),a.eq(e).addClass("active"),a.slice(0,e).addClass("complete"),r.css("width",n+"%"),s.ajax({url:ccWizard.ajaxUrl,type:"POST",data:{action:"cc_wizard_provision",nonce:ccWizard.nonce,step:o[i],token:c.doToken},success:function(e){e.success?(e.data.app_url&&(c.appUrl=e.data.app_url),e.data.access_token&&(c.accessToken=e.data.access_token),i<o.length-1?setTimeout(function(){t(i+1)},500):setTimeout(function(){c.saveCredentials()},1e3)):c.handleProvisioningError(e.data,i)},error:function(e,t,a){c.handleProvisioningError({message:"Network error: "+a,code:"network_error"},i)}})}(0)},handleProvisioningError:function(e,t){var a=s('.cc-wizard-slide[data-slide="3"]'),i=a.find(".cc-wizard-progress");let r=a.find(".cc-wizard-error"),n=r.find(".cc-wizard-error-message"),c=r.find(".cc-wizard-error-actions");s(".cc-wizard-progress-steps li").eq(t).addClass("error"),i.fadeOut(200,function(){n.text(e.message||"An error occurred during setup."),"payment_method_required"===e.code?c.html('<a href="https://cloud.digitalocean.com/account/billing" target="_blank" class="button">Add payment method</a><button type="button" class="button button-primary cc-wizard-retry">Retry setup</button>'):c.html('<button type="button" class="button button-primary cc-wizard-retry">Retry setup</button>'),r.fadeIn(300)}),s(document).on("click",".cc-wizard-retry",this.retryProvisioning.bind(this))},retryProvisioning:function(e){e.preventDefault();var e=s('.cc-wizard-slide[data-slide="3"]'),t=e.find(".cc-wizard-error");let a=e.find(".cc-wizard-progress");s(".cc-wizard-progress-steps li").removeClass("active complete error"),s(".cc-wizard-progress-fill").css("width","0%"),t.fadeOut(200,function(){a.fadeIn(300)}),this.provisionServer()},saveCredentials:function(){let t=this;s.ajax({url:ccWizard.ajaxUrl,type:"POST",data:{action:"cc_wizard_save_credentials",nonce:ccWizard.nonce,app_url:this.appUrl,access_token:this.accessToken,do_token:this.doToken},success:function(e){e.success?t.showSlide(4):alert("Failed to save credentials. Please try again.")},error:function(){alert("Failed to save credentials. Please try again.")}})},removeToken:function(e){e.preventDefault();let t=s(e.currentTarget);t.prop("disabled",!0).text("Removing..."),s.ajax({url:ccWizard.ajaxUrl,type:"POST",data:{action:"cc_wizard_remove_token",nonce:ccWizard.nonce},success:function(e){e.success?(t.text("Token removed").addClass("button-disabled"),s(".cc-wizard-token-cleanup").fadeOut(300)):(t.prop("disabled",!1).text("Remove API token"),alert("Failed to remove token. Please try again."))},error:function(){t.prop("disabled",!1).text("Remove API token"),alert("Failed to remove token. Please try again.")}})},completeWizard:function(e){e.preventDefault();let t=s(e.currentTarget);t.prop("disabled",!0).text("Completing..."),s.ajax({url:ccWizard.ajaxUrl,type:"POST",data:{action:"cc_wizard_complete",nonce:ccWizard.nonce},success:function(e){e.success?window.location.reload():(t.prop("disabled",!1).text("Continue to settings"),alert("Failed to complete setup. Please try again."))},error:function(){t.prop("disabled",!1).text("Continue to settings"),alert("Failed to complete setup. Please try again.")}})}};s(document).ready(function(){s(".cc-admin").length&&e.init()})})(jQuery);